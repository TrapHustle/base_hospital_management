<?xml version="1.0" encoding="utf-8"?>
<templates xml:space="preserve">

<t t-name="PharmacyDashboard">
    <div class="pf-dashboard">
        
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <div class="logo-mark">Pf</div>
                <span class="logo-text">PharmaFlow</span>
            </div>
            <nav class="sidebar-nav">
                <a class="nav-item active" t-on-click="() => this.setMenu('home')">
                    <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="1" width="6" height="6"/><rect x="9" y="1" width="6" height="6"/><rect x="1" y="9" width="6" height="6"/><rect x="9" y="9" width="6" height="6"/></svg>
                    Tableau de bord
                    <span class="nav-arrow">‚Ä∫</span>
                </a>
                <a class="nav-item" t-on-click="() => this.setMenu('medicines')">
                    <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="6" r="3"/><path d="M2 14c0-3.3 2.7-6 6-6s6 2.7 6 6"/></svg>
                    M√©dicaments
                </a>
                <a class="nav-item" t-on-click="() => this.setMenu('vaccines')">
                    <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M8 1l2 5h5l-4 3 1.5 5L8 11l-4.5 3L5 9 1 6h5z"/></svg>
                    Vaccins
                </a>
                <a class="nav-item" t-on-click="() => this.setMenu('suppliers')">
                    <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M1 3h14v2H1zm1 3h12l-1 9H3z"/></svg>
                    Commandes Fournisseurs
                </a>
            </nav>
            <div class="sidebar-footer">
                <a class="nav-item" t-on-click="() => this.setMenu('settings')">
                    <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="3"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2"/></svg>
                    Param√®tres
                </a>
                <a class="nav-item danger" t-on-click="logout">
                    <svg class="nav-icon" viewBox="0 0 16 16" fill="currentColor"><path d="M10 8H3m0 0l3-3M3 8l3 3M13 2v12"/></svg>
                    D√©connexion
                </a>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main">

            <!-- TOPBAR -->
            <header class="topbar">
                <div class="topbar-date">
                    <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="3" width="14" height="12" rx="0" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M5 1v4M11 1v4M1 7h14" stroke="currentColor" stroke-width="1.5"/></svg>
                    <span t-out="new Date().toLocaleDateString('fr-FR', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'})"/>
                </div>
                <div class="topbar-search">
                    <svg class="search-icon" width="13" height="13" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><circle cx="7" cy="7" r="5"/><path d="M11 11l3 3"/></svg>
                    <input type="text" placeholder="Rechercher..."/>
                </div>
                <div class="topbar-right">
                    <div class="notif-btn">
                        <svg width="15" height="15" viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a5 5 0 00-5 5v3l-2 2v1h14v-1l-2-2V6a5 5 0 00-5-5zM6 13a2 2 0 004 0z"/></svg>
                        <span class="notif-badge" t-out="state.stock_alerts.out_of_stock_count + state.stock_alerts.low_stock_count"/>
                    </div>
                    <div class="user-chip">
                        <div class="user-avatar" t-out="user.name ? user.name.substring(0, 2).toUpperCase() : 'U'"/>
                        <div>
                            <div class="user-name" t-out="user.name or 'Utilisateur'"/>
                            <div class="user-role">Pharmacien Chef</div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="content">

                <!-- PAGE HEADER (HOME) -->
                <t t-if="state.menu === 'home'">
                    <div class="page-header">
                        <div>
                            <div class="page-title">Tableau de Bord</div>
                            <div class="page-subtitle">Bienvenue, <strong t-out="user.name or 'Pharmacien'"/>. Voici l'√©tat actuel de votre pharmacie.</div>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-outline">Rapports PDF</button>
                            <button class="btn btn-primary" t-on-click="() => this.setMenu('new_order')">+ Nouvelle Commande</button>
                        </div>
                    </div>

                    <!-- KPI GRID -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-top">
                                <div class="kpi-icon-box purple">
                                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor"><path d="M1 1h14v3H1zm1 4h12l-1 9H3z"/></svg>
                                </div>
                                <span class="kpi-trend up">+12.5%</span>
                            </div>
                            <div>
                                <div class="kpi-label">Entr√©es de stock ‚Äî Ce mois</div>
                                <div class="kpi-value" t-out="state.stats.total_medicines"/>
                            </div>
                            <div class="kpi-sub">
                                <div class="kpi-sub-item"><span class="kpi-sub-label">Articles</span><span class="kpi-sub-val">852</span></div>
                                <div class="kpi-sub-item"><span class="kpi-sub-label">Valeur</span><span class="kpi-sub-val">45 200 ‚Ç¨</span></div>
                            </div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-top">
                                <div class="kpi-icon-box teal">
                                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="5" width="14" height="9" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M5 5V3a3 3 0 016 0v2" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
                                </div>
                                <span class="kpi-trend up">+5.2%</span>
                            </div>
                            <div>
                                <div class="kpi-label">Commandes Fournisseurs</div>
                                <div class="kpi-value">28</div>
                            </div>
                            <div class="kpi-sub">
                                <div class="kpi-sub-item"><span class="kpi-sub-label">En attente</span><span class="kpi-sub-val">12</span></div>
                                <div class="kpi-sub-item"><span class="kpi-sub-label">Re√ßues</span><span class="kpi-sub-val">16</span></div>
                            </div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-top">
                                <div class="kpi-icon-box green">
                                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M8 4v4l3 2" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
                                </div>
                                <span class="kpi-trend up">+5.2%</span>
                            </div>
                            <div>
                                <div class="kpi-label">Ventes du Jour</div>
                                <div class="kpi-value">
                                    <span t-out="state.currency"/><span t-out="state.stats.revenue_today"/>
                                </div>
                            </div>
                            <div class="kpi-sub">
                                <div class="kpi-sub-item"><span class="kpi-sub-label">Transactions</span><span class="kpi-sub-val" t-out="state.stats.orders_today"/></div>
                                <div class="kpi-sub-item"><span class="kpi-sub-label">Panier moy.</span><span class="kpi-sub-val">24.30 ‚Ç¨</span></div>
                            </div>
                        </div>

                        <div class="kpi-card">
                            <div class="kpi-top">
                                <div class="kpi-icon-box red">
                                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor"><path d="M8 1L1 14h14L8 1zm0 4v4m0 2v1"/><rect x="7.25" y="9" width="1.5" height="1.5" rx="0"/></svg>
                                </div>
                                <span class="kpi-trend down" t-out="'-' + (state.stock_alerts.out_of_stock_count + state.stock_alerts.low_stock_count)"/>
                            </div>
                            <div>
                                <div class="kpi-label">Produits en Alerte</div>
                                <div class="kpi-value" t-out="state.stock_alerts.out_of_stock_count + state.stock_alerts.low_stock_count"/>
                            </div>
                            <div class="kpi-sub">
                                <div class="kpi-sub-item"><span class="kpi-sub-label">Rupture</span><span class="kpi-sub-val" t-out="state.stock_alerts.out_of_stock_count"/></div>
                                <div class="kpi-sub-item"><span class="kpi-sub-label">Exp. proche</span><span class="kpi-sub-val" t-out="state.stock_alerts.expiring_count"/></div>
                            </div>
                        </div>
                    </div>

                    <!-- CHARTS GRID -->
                    <div class="dash-grid">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">√âvolution des Flux</div>
                                    <div class="card-subtitle">Entr√©es de stock vs ventes ‚Äî 7 derniers jours</div>
                                </div>
                                <button class="btn btn-outline" style="padding:5px 12px;font-size:12px;">Hebdomadaire</button>
                            </div>
                            <div class="card-body">
                                <div class="chart-wrap"><canvas id="fluxChart"/></div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">R√©partition du Stock</div>
                                    <div class="card-subtitle">Volume par cat√©gorie</div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="doughnut-wrap">
                                    <div class="doughnut-chart-wrap"><canvas id="stockChart"/></div>
                                    <div class="legend-list">
                                        <div class="legend-item">
                                            <span class="legend-label">
                                                <span class="legend-dot" style="background:#5C3D5E;"/>
                                                M√©dicaments Standard
                                            </span>
                                            <span class="legend-pct">75%</span>
                                        </div>
                                        <div class="legend-item">
                                            <span class="legend-label">
                                                <span class="legend-dot" style="background:#0D9E8A;"/>
                                                Vaccins
                                            </span>
                                            <span class="legend-pct">25%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- BOTTOM GRID: ALERTS & PRODUCTS -->
                    <div class="dash-grid-bottom">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Alertes Critiques</div>
                                    <div class="card-subtitle">√âl√©ments n√©cessitant une attention imm√©diate</div>
                                </div>
                                <button class="card-action" t-on-click="() => this.setMenu('medicines')">Voir tout ‚Ä∫</button>
                            </div>
                            <div class="alert-list">
                                <t t-if="state.stock_alerts.out_of_stock.length > 0">
                                    <t t-foreach="state.stock_alerts.out_of_stock.slice(0, 2)" t-as="item" t-key="item.id">
                                        <div class="alert-item">
                                            <div class="alert-bar red"/>
                                            <div class="alert-icon-box" style="background:var(--red-pale);color:var(--red);">
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><path d="M8 1L1 14h14L8 1zm0 5v4"/><circle cx="8" cy="12" r="0.8"/></svg>
                                            </div>
                                            <div class="alert-body">
                                                <div class="alert-text urgent"><t t-out="item.name"/> ‚Äî Rupture de stock imminente</div>
                                                <div class="alert-when">AUJOURD'HUI</div>
                                            </div>
                                        </div>
                                    </t>
                                </t>
                                <t t-if="state.stock_alerts.expiring_soon.length > 0">
                                    <t t-foreach="state.stock_alerts.expiring_soon.slice(0, 1)" t-as="item" t-key="item.id">
                                        <div class="alert-item">
                                            <div class="alert-bar orange"/>
                                            <div class="alert-icon-box" style="background:var(--orange-pale);color:var(--orange);">
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M8 4v4l2.5 2.5" fill="none" stroke="currentColor" stroke-width="1.5"/></svg>
                                            </div>
                                            <div class="alert-body">
                                                <div class="alert-text"><t t-out="item.name"/> ‚Äî Expire bient√¥t</div>
                                                <div class="alert-when">DANS 12J</div>
                                            </div>
                                        </div>
                                    </t>
                                </t>
                                <div class="alert-item">
                                    <div class="alert-bar muted"/>
                                    <div class="alert-icon-box" style="background:var(--surface);color:var(--muted);">
                                        <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor"><circle cx="8" cy="8" r="7" fill="none" stroke="currentColor" stroke-width="1.5"/><path d="M8 7v4M8 5v1" stroke="currentColor" stroke-width="1.5"/></svg>
                                    </div>
                                    <div class="alert-body">
                                        <div class="alert-text">Stock critique ‚Äî Article √† v√©rifier</div>
                                        <div class="alert-when">AUJOURD'HUI</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">Top Produits Command√©s</div>
                                    <div class="card-subtitle">Articles les plus sollicit√©s ce mois-ci</div>
                                </div>
                            </div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Produit</th>
                                        <th>Cat√©gorie</th>
                                        <th>Stock</th>
                                        <th>Commandes</th>
                                        <th/>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="state.product_lst.slice(0, 5)" t-as="prod" t-key="prod.id">
                                        <tr>
                                            <td><span class="prod-name" t-out="prod.name.substring(0, 20)"/></td>
                                            <td><span class="cat-badge">M√©dicament</span></td>
                                            <td><span class="mono" t-out="(prod.qty_available or 0).toFixed(0)"/></td>
                                            <td><span class="mono">120</span></td>
                                            <td><button class="row-action">¬∑¬∑¬∑</button></td>
                                        </tr>
                                    </t>
                                    <t t-if="state.product_lst.length === 0">
                                        <tr>
                                            <td colspan="5" style="text-align:center;padding:20px;color:var(--muted);">Aucun produit disponible</td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="footer-bar">
                        <span class="status-live"><span class="live-dot"/> Serveur Op√©rationnel</span>
                        <span>Support Technique</span>
                        <span>Confidentialit√©</span>
                        <span>¬© 2026 PharmaFlow</span>
                    </div>
                </t>

                <!-- PAGE MEDICINES -->
                <t t-if="state.menu === 'medicines'">
                    <div class="page-header">
                        <div>
                            <div class="page-title">Gestion des M√©dicaments</div>
                            <div class="page-subtitle">G√©rez votre inventaire et surveillez les stocks.</div>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-outline">Exporter CSV</button>
                            <button class="btn btn-primary">+ Ajouter M√©dicament</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Inventaire Complet</div>
                                <div class="card-subtitle" t-out="'Nombre total: ' + state.product_lst.length + ' articles'"/>
                            </div>
                        </div>
                        <table class="data-table" style="width:100%;">
                            <thead>
                                <tr>
                                    <th>Produit</th>
                                    <th>Stock</th>
                                    <th>Prix</th>
                                    <th>Cat√©gorie</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="state.product_lst.slice(0, 10)" t-as="prod" t-key="prod.id">
                                    <tr>
                                        <td><span class="prod-name" t-out="prod.name"/></td>
                                        <td><span class="mono" t-out="(prod.qty_available or 0).toFixed(0)"/></td>
                                        <td><span class="mono" t-out="(prod.list_price or 0).toFixed(2)"/> ‚Ç¨</td>
                                        <td><span class="cat-badge">M√©dicament</span></td>
                                        <td>
                                            <t t-if="(prod.qty_available or 0) === 0">
                                                <span class="cat-badge" style="background:var(--red-pale);color:var(--red);border-color:var(--red);">Rupture</span>
                                            </t>
                                            <t t-elif="(prod.qty_available or 0) &lt; 10">
                                                <span class="cat-badge" style="background:var(--orange-pale);color:var(--orange);border-color:var(--orange);">Faible</span>
                                            </t>
                                            <t t-else="">
                                                <span class="cat-badge" style="background:#EAF5EA;color:#2E7D32;border-color:#2E7D32;">OK</span>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>

                <!-- PAGE VACCINES -->
                <t t-if="state.menu === 'vaccines'">
                    <div class="page-header">
                        <div>
                            <div class="page-title">Module Vaccins</div>
                            <div class="page-subtitle">Gestion des stocks sensibles et cha√Æne du froid.</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Inventaire Vaccins</div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Vaccin</th>
                                    <th>Stock</th>
                                    <th>Conservation</th>
                                    <th>Expiration</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="state.vaccine.slice(0, 5)" t-as="vacc" t-key="vacc.id">
                                    <tr>
                                        <td><span class="prod-name" t-out="vacc.name"/></td>
                                        <td><span class="mono" t-out="(vacc.qty_available or 0).toFixed(0)"/></td>
                                        <td>üå°Ô∏è 2-8¬∞C</td>
                                        <td>Active</td>
                                        <td><span class="cat-badge" style="background:#EAF5EA;color:#2E7D32;border-color:#2E7D32;">Disponible</span></td>
                                    </tr>
                                </t>
                                <t t-if="state.vaccine.length === 0">
                                    <tr><td colspan="5" style="text-align:center;padding:20px;color:var(--muted);">Aucun vaccin</td></tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>

                <!-- PAGE SUPPLIERS -->
                <t t-if="state.menu === 'suppliers'">
                    <div class="page-header">
                        <div>
                            <div class="page-title">Commandes Fournisseurs</div>
                            <div class="page-subtitle">Suivi des approvisionnements en temps r√©el.</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Commandes en cours</div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Fournisseur</th>
                                    <th>Date Pr√©vue</th>
                                    <th>Montant</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="state.order_data.slice(0, 5)" t-as="order" t-key="order.id">
                                    <tr>
                                        <td><span class="prod-name" t-out="order.partner_id ? order.partner_id[1] : '-'"/></td>
                                        <td><t t-out="order.create_date ? order.create_date.substring(0, 10) : '-'"/></td>
                                        <td><span class="mono"><t t-out="state.currency"/><t t-out="(order.amount_total or 0).toFixed(2)"/></span></td>
                                        <td><span class="cat-badge">Confirm√©</span></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>

            </div>
        </main>

    </div>
</t>

</templates>
